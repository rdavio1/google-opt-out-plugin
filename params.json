{"name":"Google-opt-out-plugin","tagline":"Automatically exported from code.google.com/p/google-opt-out-plugin","body":"\r\n * Copyright 2010 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nvar DOUBLECLICK_DOMAIN = 'doubleclick.net';\r\nvar DOUBLECLICK_URL = 'http://' + DOUBLECLICK_DOMAIN;\r\n\r\n/**\r\n * Set opt out cookie.\r\n *\r\n * @param {string} store_id The cookie store the cookie should be stored in.\r\n */\r\nfunction optOut(store_id) {\r\n  chrome.cookies.get({name: 'id',\r\n                      url: DOUBLECLICK_URL,\r\n                      storeId: store_id}, function(cookie) {\r\n    if (!cookie || cookie.value != 'OPT_OUT') {\r\n      chrome.cookies.set({name: 'id',\r\n                          value: 'OPT_OUT',\r\n                          domain: '.' + DOUBLECLICK_DOMAIN,\r\n                          url: DOUBLECLICK_URL,\r\n                          expirationDate: 1920499146,\r\n                          storeId: store_id});\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Clear all cookies set for the domain doubleclick.net.\r\n *\r\n * @param {string} store_id The cookie store from which the cookies should be\r\n *                          removed.\r\n */\r\nfunction clearCookies(store_id) {\r\n  chrome.cookies.getAll({domain: DOUBLECLICK_DOMAIN,\r\n                         storeId: store_id},\r\n      function(cookies) {\r\n        for (var i = 0; i < cookies.length; i++) {\r\n          chrome.cookies.remove({url: DOUBLECLICK_URL + cookies[i].path,\r\n                                 name: cookies[i].name,\r\n                                 storeId: store_id});\r\n        }\r\n      }\r\n  );\r\n}\r\n\r\n/**\r\n * Listener for cookies.onChanged.\r\n *\r\n * @param evt {object} information about the cookie that was changed.\r\n */\r\nfunction onCookieChanged(evt) {\r\n  if (evt.removed &&\r\n      evt.cookie.domain == '.' + DOUBLECLICK_DOMAIN &&\r\n      evt.cookie.name == 'id') {\r\n    optOut(evt.cookie.storeId);\r\n  }\r\n}\r\n\r\nchrome.cookies.getAllCookieStores(function(cookie_stores) {\r\n  for (var i = 0; i < cookie_stores.length; i++) {\r\n    clearCookies(cookie_stores[i].id);\r\n    optOut(cookie_stores[i].id);\r\n  }\r\n});\r\nchrome.cookies.onChanged.addListener(onCookieChanged);","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}